<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Data.administracion.actividad">

  <cache />
  
  
<select id="getNextCodigo" resultType="java.lang.String">
	select max(IdActividad) from ACTIVIDAD	
</select>
  
<select id="searchPlantillaActividad" parameterType="IngSoft.administracion.bean.CriterioActividadBeanData" resultType="IngSoft.administracion.bean.ResultadoActividadBeanData">



SELECT 
inf245g2.ACTIVIDAD.IdActividad AS codigo ,
inf245g2.ACTIVIDAD.nombre as nombre,

inf245g2.ACTIVIDAD.Vacante as vacantes,
inf245g2.ACTIVIDAD.Inscritos as inscritos,



inf245g2.TIPO_ACTIVIDAD.nombre as tipoactividad,
inf245g2.ACTIVIDAD.estado as estado



FROM inf245g2.ACTIVIDAD , inf245g2.TIPO_ACTIVIDAD 


WHERE

inf245g2.ACTIVIDAD.IdTipoActividad = inf245g2.TIPO_ACTIVIDAD.IdTipoActividad

AND inf245g2.ACTIVIDAD.nombre  like  #{nombre}


ORDER BY 1 ASC
;


</select>


<select id="searchPlantillaMatriculaActividadHorario" parameterType="IngSoft.administracion.bean.CriterioActividadBeanData" resultType="IngSoft.administracion.bean.ResultadoActividadBeanData">



SELECT 
inf245g2.ACTIVIDADxDIA_SEMANA.IdActividad AS codigo ,
inf245g2.ACTIVIDAD.nombre as nombre,
inf245g2.ACTIVIDAD.Vacante as vacantes,
inf245g2.ACTIVIDAD.Inscritos as inscritos,
inf245g2.TIPO_ACTIVIDAD.nombre as tipoactividad,
inf245g2.ACTIVIDAD.estado as estado,

inf245g2.ACTIVIDADxDIA_SEMANA.Estado as estadoHorario,
inf245g2.ACTIVIDADxDIA_SEMANA.Horario  as horario
FROM inf245g2.ACTIVIDADxDIA_SEMANA  ,inf245g2.ACTIVIDAD , inf245g2.TIPO_ACTIVIDAD 
WHERE

inf245g2.ACTIVIDAD.IdTipoActividad = inf245g2.TIPO_ACTIVIDAD.IdTipoActividad
AND inf245g2.ACTIVIDADxDIA_SEMANA.IdActividad  = inf245g2.ACTIVIDAD.IdActividad

AND inf245g2.ACTIVIDAD.nombre  like  #{nombre}

group by inf245g2.ACTIVIDADxDIA_SEMANA.Horario

;


</select>

<select id="getNumeroInscritosHorariodeactividad"  resultType="IngSoft.administracion.bean.ResultadoActividadBeanData">
SELECT 
inf245g2.ACTIVIDAD_SOCIO.IdActividad AS codigo ,
inf245g2.ACTIVIDAD_SOCIO.Horario  as horario,
COUNT( ACTIVIDAD_SOCIO.Horario) as inscritos
FROM inf245g2.ACTIVIDAD_SOCIO
GROUP BY ACTIVIDAD_SOCIO.Horario
</select>


<select id="getPLantillaActividad" parameterType="java.lang.String"  resultType="IngSoft.administracion.bean.ActividadBeanData">


SELECT 
inf245g2.ACTIVIDAD.IdActividad AS codigo ,
inf245g2.ACTIVIDAD.IdSede AS nombreSede,
inf245g2.ACTIVIDAD.nombre as nombre,
inf245g2.ACTIVIDAD.IdTipoActividad as nombreTipoactividad,


inf245g2.ACTIVIDAD.IdEmpleado AS nombreEncargado,
inf245g2.ACTIVIDAD.IdAmbiente as nombreAmbientes,


inf245g2.ACTIVIDAD.FechaInicio AS fechaInicio,
inf245g2.ACTIVIDAD.FechaFin as fechaFin,
inf245g2.ACTIVIDAD.Descripcion as descripcion,
inf245g2.ACTIVIDAD.estado as estado


FROM inf245g2.ACTIVIDAD 



WHERE
    inf245g2.ACTIVIDAD.IdActividad    = #{codigo}


ORDER BY 1 ASC


</select>

<!-- Agregar plantilla ACTIVIDAD -->

<insert id="insertPlantillaActividad" parameterType="IngSoft.administracion.bean.ActividadBeanData" flushCache="true">
	insert into ACTIVIDAD (IdActividad,IdSede,Nombre,IdEmpleado,IdAmbiente,FechaInicio,FechaFin,Descripcion,IdTipoActividad,Estado)
	values (#{codigo},#{nombreSede},#{nombre},#{nombreEncargado},#{nombreAmbientes},#{fechaInicio},#{fechaFin},#{descripcion},#{nombreTipoactividad},#{estado})
</insert>


<!-- Agregar plantilla Actividad_socio -->

<insert id="insertPlantillaMatriculaActividad" parameterType="IngSoft.administracion.bean.MatriculaBeanData" flushCache="true">
	insert into ACTIVIDAD_SOCIO (IdActividad,IdSocio,Monto,FechaRegistro,IdFamiliar,Horario)
	values (#{codigoActividad},#{codigosocio},#{monto},#{fecha},#{codigofamiliar},#{horario})
</insert>

<delete id="deletePLantillaMatriculaActividadSocio" parameterType="java.lang.String" >
DELETE FROM `inf245g2`.`ACTIVIDAD_SOCIO` 
WHERE `IdActividad`=#{codigoActividad} 
and`IdSocio`=#{codigosocio}
and`Horario`=#{horario}
;

</delete>





<select id="getMatriculadosactividad" parameterType="IngSoft.administracion.bean.MatriculaBeanData" resultType="IngSoft.administracion.bean.MatriculaBeanData">

SELECT 
inf245g2.ACTIVIDAD_SOCIO.IdActividad AS codigoActividad,
inf245g2.ACTIVIDAD.Nombre AS nombreAtc ,
inf245g2.ACTIVIDAD.Vacante AS vacantes ,
inf245g2.ACTIVIDAD.Inscritos AS inscritos ,

inf245g2.ACTIVIDAD_SOCIO.IdSocio AS codigosocio,
inf245g2.PERSONA.Nombres AS nombreSoc,
inf245g2.PERSONA.ApePaterno AS apaternoSoc,
inf245g2.PERSONA.ApeMaterno AS amaternoSoc,

inf245g2.ACTIVIDAD_SOCIO.Monto AS monto,
inf245g2.ACTIVIDAD_SOCIO.FechaRegistro AS fecha,


inf245g2.ACTIVIDAD_SOCIO.IdFamiliar AS codigofamiliar,
SOC.Nombres AS nombreFam,
SOC.ApePaterno AS apaternoFam,
SOC.ApeMaterno AS amaternoFam,


inf245g2.ACTIVIDAD_SOCIO.Horario AS horario

FROM inf245g2.ACTIVIDAD_SOCIO
LEFT JOIN  inf245g2.PERSONA 
ON inf245g2.ACTIVIDAD_SOCIO.IdSocio = inf245g2.PERSONA.IdPersona

LEFT JOIN  inf245g2.PERSONA SOC
ON inf245g2.ACTIVIDAD_SOCIO.IdFamiliar = SOC.IdPersona

LEFT JOIN  inf245g2.ACTIVIDAD
ON inf245g2.ACTIVIDAD_SOCIO.IdActividad = inf245g2.ACTIVIDAD.IdActividad

WHERE 
    inf245g2.ACTIVIDAD_SOCIO.IdActividad = #{codigoActividad}
AND inf245g2.ACTIVIDAD_SOCIO.Horario = #{horario}
</select>

<!-- Fin eliminar -->




<!--Modificar ACTIVIDAD -->

<update id="modificarPlantillaActividad" parameterType="IngSoft.administracion.bean.ActividadBeanData" >
update ACTIVIDAD 
set
IdSede	=	#{nombreSede} ,
Nombre	=	#{nombre} ,
IdEmpleado	=	#{nombreEncargado} ,
IdAmbiente	=	#{nombreAmbientes} ,
FechaInicio	=	#{fechaInicio} ,
FechaFin	=	#{fechaFin} ,
Descripcion	=	#{descripcion} ,
IdTipoActividad	=	#{nombreTipoactividad},
estado	=	#{estado}

where IdActividad= #{codigo}
</update>
<!-- Fin eliminar -->

<!--Eliminar sede -->

<update id="deletePLantillaActividad" parameterType="java.lang.String" >
update ACTIVIDAD set Estado ='No Disponible' where IdActividad = #{codigo}
</update>
<!-- Fin eliminar -->




<!-- tipoactividad  -->
<select id="getTipoactividad" resultType="IngSoft.administracion.bean.TipoActividadMiniBeanData">
select TIPO_ACTIVIDAD.IdTipoActividad as codigo
, TIPO_ACTIVIDAD.Nombre as nombre
from 
TIPO_ACTIVIDAD; 

</select>

<select id="getHorariosActividad" resultType="IngSoft.administracion.bean.ResultadoHorariodeactividadBeanData">


SELECT 
inf245g2.ACTIVIDADxDIA_SEMANA.Horario AS Horario
,inf245g2.ACTIVIDAD.IdActividad AS codigo
,inf245g2.ACTIVIDAD.Nombre AS nombre
,group_concat(inf245g2.DIA_SEMANA.IdDiaSemana ) AS codDiasemana
,group_concat(inf245g2.DIA_SEMANA.Nombre,' ', DATE_FORMAT(inf245g2.ACTIVIDADxDIA_SEMANA.HoraInicio,'%h:%i'),'-',DATE_FORMAT(inf245g2.ACTIVIDADxDIA_SEMANA.HoraFin ,'%h:%i') SEPARATOR ' / '  ) AS diaSemana
,inf245g2.ACTIVIDAD.Costo AS monto
FROM
      inf245g2.ACTIVIDAD,  inf245g2.DIA_SEMANA, inf245g2.ACTIVIDADxDIA_SEMANA
WHERE
		
	  inf245g2.ACTIVIDAD.IdActividad         = inf245g2.ACTIVIDADxDIA_SEMANA.IdActividad 
AND   inf245g2.DIA_SEMANA.IdDiaSemana    = inf245g2.ACTIVIDADxDIA_SEMANA.IdDiaSemana
AND    inf245g2.ACTIVIDAD.IdActividad  like  #{codigo} 

group by inf245g2.ACTIVIDADxDIA_SEMANA.Horario 


</select>






<!-- sedes  -->
<select id="getSede" resultType="IngSoft.administracion.bean.SedeBeanData">
select SEDE.IdSede as codigo
, SEDE.Nombre as nombre
from 
SEDE; 

</select>

<!-- ambientes  -->
<select id="getAmbiente" resultType="IngSoft.administracion.bean.AmbienteBeanData">
select AMBIENTE.IdAmbiente as codigo
, AMBIENTE.Nombre as nombre
from 
AMBIENTE; 

</select>

<!-- getEmpleado  -->
<select id="getEmpleado" resultType="IngSoft.administracion.bean.ResultadoEmpleadoBeanData">
SELECT 
inf245g2.PERSONA.IdPersona AS codigo ,
inf245g2.PERSONA.Nombres as nombre,
inf245g2.PERSONA.ApePaterno as apaterno,
inf245g2.EMPLEADO.Puesto as puesto,
inf245g2.EMPLEADO.Estado as estado


FROM inf245g2.EMPLEADO , inf245g2.PERSONA 


WHERE

inf245g2.EMPLEADO.IdEmpleado = inf245g2.PERSONA.IdPersona




ORDER BY 1 ASC
;

</select>




<!-- complemto para buscar empleado   -->
<select id="searchPlantillaEmpleadoSeleccion" parameterType="IngSoft.administracion.bean.CriterioEmpleadoBeanData" resultType="IngSoft.administracion.bean.ResultadoEmpleadoBeanData">



SELECT 
inf245g2.PERSONA.IdPersona AS codigo ,
inf245g2.PERSONA.Nombres as nombre,
inf245g2.PERSONA.ApePaterno as apaterno,
inf245g2.EMPLEADO.Puesto as puesto,
inf245g2.EMPLEADO.Estado as estado


FROM inf245g2.EMPLEADO , inf245g2.PERSONA 


WHERE

inf245g2.EMPLEADO.IdEmpleado = inf245g2.PERSONA.IdPersona
AND inf245g2.PERSONA.Nombres  like  #{nombre}



ORDER BY 1 ASC
;


</select>



<!-- complemto para buscar SocioMatricula   -->
<select id="searchPlantillaSocioMatricula" parameterType="IngSoft.administracion.bean.PersonaBeanData" resultType="IngSoft.administracion.bean.PersonaBeanData">




SELECT 
inf245g2.SOCIO.IdSocio  AS codigo ,
SOC.Nombres AS nombre,
SOC.ApePaterno AS apaterno,
SOC.ApeMaterno AS amaterno,

inf245g2.FAMILIAR.IdFamiliar AS codigofam ,
FAM.Nombres AS nombrefam,
FAM.ApePaterno AS apaternofam,
FAM.ApeMaterno AS amaternofam

FROM inf245g2.SOCIO  
LEFT JOIN  inf245g2.FAMILIAR 
ON inf245g2.SOCIO.IdSocio = inf245g2.FAMILIAR.IdSocio

LEFT JOIN  inf245g2.PERSONA SOC
ON inf245g2.SOCIO.IdSocio = SOC.IdPersona

LEFT JOIN  inf245g2.PERSONA FAM
ON inf245g2.FAMILIAR.IdFamiliar = FAM.IdPersona


ORDER BY 1 ASC
;







</select>




</mapper>