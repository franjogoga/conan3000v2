<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Data.administracion.ambiente">
	<cache />

	<select id="searchAmbiente" parameterType="IngSoft.administracion.bean.CriterioAmbienteBeanData" resultType="IngSoft.administracion.bean.ResultadoAmbienteBeanData">
		SELECT AMBIENTE.IdAmbiente as codigo, AMBIENTE.Nombre as nombre, SEDE.Nombre as nombreSede, TIPO_AMBIENTE.Nombre as nombreTipoAmbiente, AMBIENTE.Estado as estado
		FROM AMBIENTE, TIPO_AMBIENTE, SEDE
		<where>
		<if test="nombre != null">
       		AMBIENTE.Nombre  like  #{nombre}
    	</if>
    	<if test="idTipoAmbiente != null ">
       		AND AMBIENTE.IdTipoAmbiente = #{idTipoAmbiente}
    	</if>
    	<if test="idSede != null">
        	AND AMBIENTE.IdSede = #{idSede}
    	</if>
    		AND AMBIENTE.IdSede=SEDE.IdSede AND TIPO_AMBIENTE.IdTipoAmbiente = AMBIENTE.IdTipoAmbiente AND AMBIENTE.Estado='Activo'
		</where>
	</select>
 
 	<select id="searchSedeMini" resultType="IngSoft.administracion.bean.SedeMiniBeanData">
		select IdSede as codigo, Nombre as nombre 
		from SEDE
	</select>
	
	<select id="searchTipoAmbienteMini" resultType="IngSoft.administracion.bean.TipoAmbienteMiniBeanData">
		select IdTipoAmbiente as codigo, Nombre as nombre 
		from TIPO_AMBIENTE
	</select>

	<insert id="insertAmbiente" parameterType="IngSoft.administracion.bean.AmbienteBeanData" flushCache="true">
		insert into AMBIENTE(IdAmbiente,Nombre,IdSede,Descripcion,Caracteristicas,IdTipoAmbiente,Estado)
		values (#{codigo},#{nombre},#{idSede},#{descripcion},#{caracteristicas},#{idTipoAmbiente},'Activo')
	</insert>

	<select id="getNextCodigo" resultType="java.lang.String">
	 	SELECT MAX(IdAmbiente) FROM AMBIENTE	
	</select>

	<select id="getAmbiente" parameterType="java.lang.String"  resultType="IngSoft.administracion.bean.AmbienteBeanData">
		select IdAmbiente as codigo, Nombre as nombre, IdSede as idSede, Descripcion as descripcion,
			   Caracteristicas as caracteristicas, IdTipoAmbiente as idTipoAmbiente, Estado as estado
		from AMBIENTE
		where Estado = 'Activo' and  IdAmbiente = #{codigo}; 
	</select>

	<update id="updateAmbiente" parameterType="IngSoft.administracion.bean.AmbienteBeanData">
		update AMBIENTE set
		Nombre = #{nombre},
		IdSede = #{idSede},
		Descripcion = #{descripcion},
		Caracteristicas = #{caracteristicas}
		IdTipoAmbiente = #{idTipoAmbiente}
		Estado = #{estado}
	 	where IdAmbiente = #{codigo}
	</update>

	<update id="deleteAmbiente" parameterType="java.lang.String" >
		update AMBIENTE set Estado='Eliminado' where IdAmbiente = #{codigo}
	</update>
	
</mapper>