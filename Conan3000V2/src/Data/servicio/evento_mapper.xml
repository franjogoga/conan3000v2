<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Data.servicio.evento">

  <cache />

<select id="searchPlantillaEvento" parameterType="IngSoft.servicio.bean.CriterioEventoBeanData" resultType="IngSoft.servicio.bean.ResultadoEventoBeanData">
select 
PLANTILLA_EVENTO.IdPlantillaEvento as codigo
,TIPO_EVENTO.nombre as tipo
,PLANTILLA_EVENTO.nombre as nombre
,PLANTILLA_EVENTO.FechaInicio as limInicio
,PLANTILLA_EVENTO.FechaFin as limFin
from PLANTILLA_EVENTO 
left JOIN TIPO_EVENTO on TIPO_EVENTO.IdTipoEvento=PLANTILLA_EVENTO.IdTipoEvento 
<where>
<if test="nombre != null ">
        PLANTILLA_EVENTO.nombre  like  #{nombre}
    </if>
    <if test="tipo != null and tipo.length()>1">
        AND TIPO_EVENTO.IdTipoEvento = #{tipo}
    </if>
    <if test="limInicio != null">
        AND PLANTILLA_EVENTO.FechaInicio &gt;= #{limInicio}
    </if>
    <if test="limFin != null">
        AND PLANTILLA_EVENTO.FechaFin &lt;= #{limFin}
    </if>
    AND PLANTILLA_EVENTO.Estado='A'
</where>
order by 1 asc
</select>
<select id="searchEventoSedeMini" parameterType="hashmap" resultType="IngSoft.servicio.bean.EventoBeanData">
select 
es.IdEventoSede as codigo
,es.Nombre as nombre
,es.Fecha as fecha
,s.Nombre as idSede
,es.Estado as estado
from 
EVENTO_SEDE es
, SEDE s 
where 
es.IdSede= s.IdSede
and es.Estado like #{estado}
and es.IdSede like #{sede}
and DATE(es.Fecha) &gt;= DATE(#{FI})
and DATE(es.Fecha) &lt;= DATE(#{FF})
and es.Nombre like #{nombre}
</select>

<select id="searchEventoSocioMini" parameterType="hashmap" resultType="IngSoft.servicio.bean.EventoBeanData">
select 
so.IdEventoSocio as codigo
,so.Nombre as nombre
,so.Fecha as fecha
,s.Nombre as idSede
,so.Estado as estado
from 
EVENTO_SOCIO so
, SEDE s 
where 
so.IdSede= s.IdSede
and so.Estado like #{estado}
and so.IdSede like #{sede}
and DATE(so.Fecha) &gt;= DATE(#{FI})
and DATE(so.Fecha) &lt;= DATE(#{FF})
and so.Nombre like #{nombre}
and so.IdSocio like #{socio}
</select>


<select id="searchSedeMini" resultType="IngSoft.servicio.bean.SedeMiniBeanData">
	select IdSede as codigo
	,Nombre 
	from 
	SEDE
	order by 1
</select>

<select id="searchAmbienteMini" resultType="IngSoft.servicio.bean.AmbienteMiniBeanData">
	select IdTipoAmbiente as codigo
	,Nombre 
	from 
	TIPO_AMBIENTE 
	order by 1
</select>
<select id="searchTipoEventoMini" resultType="IngSoft.servicio.bean.TipoEventoMiniBeanData">
	select IdTipoEvento as codigo
	,Nombre 
	from 
	TIPO_EVENTO
	order by 1
</select>

<!--Aprobar eventos  -->
<update id="aprobarEventoSocio" parameterType="java.lang.String">
	update EVENTO_SOCIO set Estado='APROBADO' where IdEventoSocio=#{codigo};	
</update>
<update id="aprobarEventoSede" parameterType="java.lang.String">
	update EVENTO_SEDE set Estado='APROBADO' where IdEventoSede=#{codigo};	
</update>
<!-- Fin aprobar eventos -->
<!-- Anular eventos -->
<update id="anularEventoSocio" parameterType="java.lang.String">
	update EVENTO_SOCIO set Estado='ANULADO' where IdEventoSocio=#{codigo};	
</update>
<update id="anularEventoSede" parameterType="java.lang.String">
	update EVENTO_SEDE set Estado='ANULADO' where IdEventoSede=#{codigo};	
</update>
<!-- Fin Anular eventos -->
<!-- Generar codigos -->
<select id="getNextCodigoSdE" resultType="java.lang.String">
	select Max(IdEventoSede) from  EVENTO_SEDE	
</select>
<select id="getNextCodigoScE" resultType="java.lang.String">
	select Max(IdEventoSocio) from  EVENTO_SOCIO	
</select>
<!-- Fin generar codigo -->
<!-- insertar solicitudes -->
<insert id="insertEventoxSede" parameterType="hashmap">
insert into 
EVENTO_SEDE(IdEventoSede,Nombre,LimiteEntradas,Precio,IdSede,IdConcesionario,Estado,Fecha,EntradasTotal)
values
(#{codigo},#{nombre},#{limiteE},#{precio},#{sede},#{concesionario},'REGISTRADO',#{fecha},0)
</insert>
<insert id="insertEventoxSocio" parameterType="hashmap">
insert into 
EVENTO_SOCIO
(IdEventoSocio,Nombre,IdSocio,IdSede,Fecha,MontoTotal,IdConcesionario,Estado)
values(#{codigo},#{nombre},#{socio},#{sede},#{fecha},#{monto},#{concesionario},'REGISTRADO')
</insert>
 <!-- Fin insertar solicitudes  -->
 
<select id="getAmbientesId" parameterType="java.lang.String"  resultType="java.lang.String">
select IdAmbiente from AMBIENTExPLANTILLA where IdPlantillaEvento= #{codigo};
</select>

<select id="getSedesId" parameterType="java.lang.String"  resultType="java.lang.String">
select IdSede  from SEDExPLANTILLA where IdPlantillaEvento= #{codigo};
</select>
<!-- consultar solicitudes -->
<select id="getConcecionarioxSede" parameterType="hashmap" resultType="IngSoft.servicio.bean.ConcesionarioMiniBeanData">
select c.IdConcesionario as codigo
,c.RazonSocial as razonSocial
,c.Descripcion as descripcion
from
CONCESIONARIO c
,CONCESIONARIOxSEDE cs 
where 
c.IdConcesionario= cs.IdConcesionario
and cs.IdSede like #{idsede}
and DATE(cs.FechaFin)&gt;=DATE(#{fecha})
and DATE(cs.FechaInicio)&lt;=DATE(#{fecha})
</select>
<select id="searchEventoSede" parameterType="java.lang.String" resultType="IngSoft.servicio.bean.EventoBeanData">
select 
es.IdEventoSede as codigo
,es.Nombre as nombre
,es.Fecha as fecha
,es.IdSede as idSede
,es.Estado as estado
,es.IdConcesionario as idConcesionario
,es.LimiteEntradas as limiteEntradas
,es.Precio as monto
,es.EntradasTotal as entradasTotal
from 
EVENTO_SEDE es
where 
es.IdEventoSede like #{codigo}
</select>
<select id="searchEventoSocio" parameterType="java.lang.String" resultType="IngSoft.servicio.bean.EventoBeanData">
SELECT
IdEventoSocio as codigo,
Nombre as nombre,
IdSocio as socio,
IdSede as idSede,
Fecha as fecha,
MontoTotal as monto,
IdConcesionario as idConcesionario,
Estado as estado
FROM EVENTO_SOCIO 
where
IdEventoSocio like #{codigo};
</select>

<!-- consultar solicitudes -->
<!-- Modificar elemento -->
<update id="updatePLantillaEvento" parameterType="IngSoft.servicio.bean.EventoBeanData">
update PLANTILLA_EVENTO set nombre=#{nombre}
 ,IdTipoEvento=#{idTipo}
 ,FechaInicio=#{limiteInicio}
 ,FechaFin=#{limiteFin}
 where IdPlantillaEvento= #{codigo}
</update>

<!-- Fin modificar -->
<!--Inscribir en Evento sede -->
<insert id="inscribirEventoSede" parameterType="hashmap">
INSERT INTO SOCIOxEVENTO_SEDE (IdSocio,IdEventoSede,CantEntrAdquiridas,Monto)
VALUES (#{socio},#{codigo},#{cantidad},#{monto})   
</insert>
<!-- Fin Inscribir en Evento sede -->
</mapper>