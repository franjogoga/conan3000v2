<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Data.servicio.evento">

  <cache />

<select id="searchPlantillaEvento" parameterType="IngSoft.servicio.bean.CriterioEventoBeanData" resultType="IngSoft.servicio.bean.ResultadoEventoBeanData">
select 
plantilla_evento.id_plantilla_evento as codigo
,tipo_evento.nombre as tipo
,plantilla_evento.nombre as nombre
,plantilla_evento.lim_inicio as limInicio
,plantilla_evento.lim_fin as limFin
from plantilla_evento 
left JOIN tipo_evento on tipo_evento.id_tipo_evento=plantilla_evento.id_tipo_evento 
<where>
<if test="nombre != null ">
        plantilla_evento.nombre  like  #{nombre}
    </if>
    <if test="tipo != null and tipo>0">
        AND tipo_evento.id_tipo_evento = #{tipo}
    </if>
    <if test="limInicio != null">
        AND plantilla_evento.lim_inicio &gt;= #{limInicio}
    </if>
    <if test="limFin != null">
        AND plantilla_evento.lim_fin &lt;= #{limFin}
    </if>
    AND plantilla_evento.estado='A'
</where>
order by 1 asc
</select>
<select id="searchSedeMini" resultType="IngSoft.servicio.bean.SedeMiniBeanData">
	select id_sede as codigo
	,nombre 
	from 
	sede
</select>
<select id="searchAmbienteMini" resultType="IngSoft.servicio.bean.AmbienteMiniBeanData">
	select id_tipo_ambiente as codigo
	,nombre 
	from 
	tipo_ambiente
</select>
<select id="searchTipoEventoMini" resultType="IngSoft.servicio.bean.TipoEventoMiniBeanData">
	select id_tipo_evento as codigo
	,nombre 
	from 
	tipo_evento
</select>

<!-- Agregar plantilla evento -->
<insert id="insertPlantillaEvento" parameterType="IngSoft.servicio.bean.EventoBeanData" flushCache="true">
	insert into plantilla_evento(id_plantilla_evento,nombre,lim_inicio,lim_fin,id_tipo_evento,estado)
	values (#{codigo},#{nombre},#{limiteInicio},#{limiteFin},#{idTipo},'A')
</insert>
<select id="getNextCodigo" resultType="java.lang.String">
	select max(id_plantilla_evento)+1 from plantilla_evento	
</select>
<insert id="insertPlantillaEventoSedes" parameterType="IngSoft.servicio.bean.EventoBeanData" flushCache="true">
 insert into plantilla_eventoxsede(id_plantilla_evento,id_sede) values(#{codigo},
 <foreach item="idSede" index="i" collection="idSede" separator="),(#{codigo}," close=")">
 	#{idSede}
 </foreach>
</insert>
 <!-- Fin agregar  -->
 
<select id="getAmbientesId" parameterType="int" resultType="java.lang.String">
select id_tipo_ambiente  from plantilla_eventoxtipo_ambiente where id_plantilla_evento= #{codigo};
</select>

<select id="getSedesId" parameterType="int" resultType="java.lang.String">
select id_sede  from plantilla_eventoxsede where id_plantilla_evento= #{codigo};
</select>

<select id="getPLantillaEvento" parameterType="int" resultType="IngSoft.servicio.bean.EventoBeanData">
select 
id_plantilla_evento as codigo
,id_tipo_evento as idTipo
,nombre as nombre
,lim_inicio as limiteInicio
,lim_fin as limiteFin
from plantilla_evento  pe where pe.estado='A' and  pe.id_plantilla_evento=#{codigo}; 
</select>
<!-- Modificar elemento -->
<update id="updatePLantillaEvento" parameterType="IngSoft.servicio.bean.EventoBeanData">
update plantilla_evento set nombre=#{nombre}
 ,id_tipo=#{idtipo}
 ,lim_inicio=#{limiteInicio}
 ,lim_fin=#{limiteFin}
 where id_plantilla_evento= #{codigo}
</update>

<!-- Fin modificar -->
<!--Eliminar evento -->
<update id="deletePLantillaEvento" parameterType="int">
update plantilla_evento set estado='I' where id_plantilla_evento= #{codigo}
</update>
<!-- Fin eliminar -->
</mapper>