<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Data.servicio.reserva">

  <cache />

<select id="searchBungalowxSede" parameterType="hashmap" resultType="IngSoft.servicio.bean.ReservaBungalowMiniBeanData">
select r1.codigoBungalow
,r1.nombreBungalow
,r2.codigoSocio
,r2.fecha
from
(select b.IdBungalow as codigoBungalow
,b.Numero as nombreBungalow
,a.IdSede as codigoSede
from 
BUNGALOW b 
left join 
AMBIENTE a 
on a.IdAmbiente=b.IdAmbiente
where 
b.Estado ="ACTIVO") r1 
left join
(select rb.IdBungalow as codigoBungalow
,rb.IdReservaBungalow as codigoReserva
,rb.IdSocio  as codigoSocio
,bf.Fecha as Fecha
from 
RESERVA_BUNGALOW rb,
BUNGALOWxFECHA bf 
where bf.IdReservaBungalow=rb.IdReservaBungalow
and rb.Estado='ACTIVO'
and bf.Fecha &gt;= #{fecIni}
and bf.Fecha &lt;= #{fecFin}) r2
on r1.codigoBungalow=r2.codigoBungalow
where r1.codigoSede like #{codigo}
order by 2 asc,1,4;
</select>
<select id="searchCanchaxTipoxSede" parameterType="hashmap" resultType="IngSoft.servicio.bean.ReservaCanchaMiniBeanData">
select r1.codigoCancha
,r1.descCancha
,r2.codigoSocio
,r2.fecha
,r2.horaIni
,r2.horaFin 
from
(select c.IdCancha as codigoCancha
,c.Descripcion as descCancha
,a.IdSede as codigoSede
,tc.Nombre as tipo
from 
CANCHA c 
left join 
AMBIENTE a
on a.IdAmbiente=c.IdAmbiente
left join 
TIPO_CANCHA tc 
on tc.IdTipoCancha=c.IdTipoCancha
where 
c.Estado ='ACTIVO'
and a.IdSede like #{codSede}
and tc.IdTipoCancha like #{codTipoCancha}) r1
left join
(select rc.IdCancha as codigoCancha
,rc.IdReservaCancha as codigoReserva
,rc.IdSocio  as codigoSocio
,cf.Fecha as fecha
,cf.HoraInicio as horaIni
,cf.HoraFin as horaFin 
from 
RESERVA_CANCHA rc,
CANCHAxFECHA cf 
where cf.IdReservaCancha=rc.IdReservaCancha
and rc.Estado='ACTIVO'
and cf.Fecha &gt;= #{fecIni}
and cf.Fecha &lt;= #{fecFin}) r2
on r1.codigoCancha=r2.codigoCancha 
order by 1 asc,5,4;
</select>

<select id="confirmarSocio" parameterType="java.lang.String" resultType="hashmap">
select CONCAT(s.IdSocio,'/',p.Nombres
,' ',p.ApePaterno
,' ',p.ApeMaterno ) as respuesta
from SOCIO s
,PERSONA p 
where s.IdSocio=p.IdPersona 
and p.NumeroDocumento=#{codigo};
</select>


<select id="getNextCodigoB" resultType="java.lang.String">
	select max(IdReservaBungalow) from RESERVA_BUNGALOW;	
</select>
<select id="getNextCodigoC" resultType="java.lang.String">
	select max(IdReservaCancha) from RESERVA_CANCHA;	
</select>
<insert id="insertBungalowReserva" parameterType="hashmap">
insert into RESERVA_BUNGALOW(Estado,IdSocio,IdBungalow,IdReservaBungalow)
values('ACTIVO',#{idsocio},#{idbungalow},#{idreservasbungalow})
;
</insert>
<insert id="insertBungalowReservaFecha" parameterType="hashmap">
insert into BUNGALOWxFECHA(IdReservaBungalow,Fecha) values(#{idreservasbungalow},#{fecha})
;
</insert>
</mapper>