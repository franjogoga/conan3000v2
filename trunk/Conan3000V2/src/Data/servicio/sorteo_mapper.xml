<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Data.servicio.sorteo">

  <cache />

<select id="searchPlantillaSorteo" parameterType="IngSoft.servicio.bean.CriterioSorteoBeanData" resultType="IngSoft.servicio.bean.ResultadoSorteoBeanData">
select 
SORTEO.IdSorteo as codigo,
SORTEO.Descripcion as nombre,
SORTEO.FechaInicioIncr as fechaIni,
SORTEO.FechaFinInscr as fechaFin,
SORTEO.FechaSorteo fechaSorteo,
SORTEO.Estado as estado
from SORTEO 
<where>
<if test="nombre != null ">
        SORTEO.Descripcion like  #{nombre}
    </if>
    <if test="fechaIni != null">
        AND SORTEO.FechaInicioIncr &gt;= #{fechaIni}
    </if>
    <if test="fechaFin != null">
        AND SORTEO.FechaFinInscr &lt;= #{fechaFin}
    </if>
</where>
order by 1 asc
</select>
<select id="searchSedeMini2" resultType="IngSoft.servicio.bean.SedeMiniBeanData">
	select nombre 
	from 
	sede
</select>

<!-- Agregar plantilla Sorteo -->
<insert id="insertPlantillaSorteo" parameterType="IngSoft.servicio.bean.SorteoBeanData" flushCache="true">
	insert into SORTEO(idSede,idSorteo,FechaInicioIncr,Descripcion,FechaFinInscr,FechaSorteo, Estado)
	values (#{idSede},#{idSorteo},#{fechaInicio},#{descripcion},#{fechaFin},#{fechaSorteo},'ACTIVADO')
</insert>
<select id="getNextCodigo" resultType="java.lang.String">
	select max(IdSorteo) from SORTEO	
</select>
<select id="getNextCodigoSorteo" parameterType="java.lang.String" resultType="java.lang.String">
	select IdSede from SEDE where upper(IdSede) like '%#{idSede}%'	
</select>
 <!-- Fin agregar  -->
 
<select id="getSedeId" parameterType="java.lang.String"  resultType="java.lang.String">
select IdSede from SORTEO where IdSorteo= #{codigo};
</select> 

<select id="getPLantillaSorteo" parameterType="String" resultType="IngSoft.servicio.bean.SorteoBeanData">
select 
IdSorteo as idSorteo,
IdSede as idSede,
Descripcion as descripcion,
FechaInicioIncr as fechaInicio,
FechaFinInscr as fechaFin,
FechaSorteo as fechaSorteo,
Estado as estado
from SORTEO s where s.IdSorteo=#{codigo}; 
</select>
<!--
 Modificar elemento 
<update id="updatePLantillaEvento" parameterType="IngSoft.servicio.bean.EventoBeanData">
update plantilla_evento set nombre=#{nombre}
 ,id_tipo=#{idtipo}
 ,lim_inicio=#{limiteInicio}
 ,lim_fin=#{limiteFin}
 where id_plantilla_evento= #{codigo}
</update>

 Fin modificar 
Eliminar evento 
-->
<update id="deletePLantillaSorteo" parameterType="String">
DELETE FROM SORTEO where IdSorteo= #{codigo}
</update>

<insert id="insertPlantillaSorteoSedesUpdate" parameterType="IngSoft.servicio.bean.ModificacionesSorteoBeanData" >
insert into SORTEO(IdSorteo,IdSede) values(#{codigo},#{nuevo})
</insert>
<update id="updatePlantillaSorteo" parameterType="IngSoft.servicio.bean.ModificacionesSorteoBeanData">
update SORTEO 
	set IdSede=#{idSede}, 
	set FechaInicioIncr=#{fechaInicio},
	set FechaFinInscr=#{fechaFin},
	set FechaSorteo=#{fechaSorteo}
	where IdSorteo=#{idSorteo} 
</update>
<delete id="deletePlantillaSorteoSede" parameterType="IngSoft.servicio.bean.ModificacionesEventoBeanData">
delete from SORTEO where IdSorteo=#{codigo} and IdSede=#{antiguo}
</delete>

</mapper>