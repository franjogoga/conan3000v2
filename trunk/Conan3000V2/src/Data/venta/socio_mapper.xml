<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Data.venta.socio">

  <cache />

 <select id="searchPlantillaSocio" parameterType="IngSoft.venta.bean.CriterioSocioBeanData" resultType="IngSoft.venta.bean.ResultadoSocioBeanData">
select 
SOCIO.IdSocio as idSocio
,SOCIO.Direccion as direccion
,PERSONA.Nombres as nombres
,PERSONA.ApePaterno as apellidoPaterno
,PERSONA.ApeMaterno as apellidoMaterno
,PERSONA.TipoDocumento as tipoDocumento
,PERSONA.NumeroDocumento as numeroDocumento
from SOCIO,PERSONA,MEMBRESIA
<where>
	<if test="nombres != null ">
        SOCIO.IdSocio=PERSONA.IdPersona and (PERSONA.nombres  like  #{nombres})
    </if>
    <if test="apellidoPaterno != null ">
        AND (PERSONA.ApePaterno  like  #{apellidoPaterno})
    </if>
    <if test="apellidoMaterno != null ">
        AND (PERSONA.ApePaterno  like  #{apellidoPaterno})
    </if>
    <if test="direccion != null">
        AND SOCIO.Direccion like #{direccion}
    </if>
     <if test="tipoDocumento != null">
        AND PERSONA.TipoDocumento like #{tipoDocumento}
    </if>
      AND MEMBRESIA.IdSocio=SOCIO.IdSocio and MEMBRESIA.Estado='Activo'
</where>
</select>

  
<!-- Agregar plantilla socio -->
<insert id="insertSocio" parameterType="IngSoft.venta.bean.SocioBeanData" flushCache="true">
	insert into SOCIO(IdSocio,IdPerfil,Direccion,Correo,TelefonoFijo,IdSolicitudIngreso,IdDistrito,TelefonoCelular)
	values (#{codigo},'PER000010',#{direccion},#{correoElectronico},#{telefonoFijo},'SOL000001',#{idDistrito},#{telefonoCelular})
</insert>

<insert id="insertPersona" parameterType="IngSoft.venta.bean.PersonaMiniBeanData" flushCache="true">
	insert into PERSONA(IdPersona,Nombres,ApePaterno,ApeMaterno,NumeroDocumento,TipoDocumento,FechaNac)
	values (#{codigo},#{nombres},#{apellidoPaterno},#{apellidoMaterno},#{numeroDocumento},#{tipoDocumento},#{fechaNacimiento})
</insert>

 <!-- Fin agregar  -->
 
<select id="getNextCodigo3" resultType="java.lang.String">
	select max(IdSocio) from SOCIO
</select>

<select id="searchDistritoMini" resultType="IngSoft.venta.bean.DistritoMiniBeanData">
	select IdDistrito as idDistrito
	,Nombre as nombreDistrito
	from 
	DISTRITO
</select>

<select id="getPlantillaSocio" parameterType="java.lang.String"  resultType="IngSoft.venta.bean.SocioBeanData">
select 
SOCIO.IdSocio as codigo
,SOCIO.IdSocio as codigo2
,SOCIO.Direccion as direccion
,SOCIO.Correo as correoElectronico
,SOCIO.TelefonoFijo as telefonoFijo
,SOCIO.TelefonoCelular as telefonoCelular
from SOCIO  where SOCIO.IdSocio=#{codigo}; 
</select>

<select id="getPlantillaPersona" parameterType="java.lang.String"  resultType="IngSoft.venta.bean.PersonaMiniBeanData">
select 
PERSONA.IdPersona as codigo
,PERSONA.Nombres as nombres
,PERSONA.ApePaterno as apellidoPaterno
,PERSONA.ApeMaterno as apellidoMaterno
,PERSONA.TipoDocumento as tipoDocumento
,PERSONA.FechaNac as fechaNacimiento
,PERSONA.NumeroDocumento as numeroDocumento
from PERSONA  where PERSONA.IdPersona=#{codigo}; 
</select>

<!--Eliminar socio -->
<update id="deleteSocio" parameterType="java.lang.String" >
update MEMBRESIA set MEMBRESIA.Estado='Eliminado' where MEMBRESIA.IdSocio=#{codigo}
</update>
<!-- Fin eliminar -->


 <!-- Modificar socio -->
<update id="updateSocio" parameterType="IngSoft.venta.bean.SocioBeanData">
update SOCIO set Direccion=#{direccion}
 ,SOCIO.Correo=#{correoElectronico}
 ,SOCIO.TelefonoFijo=#{telefonoFijo}
 ,SOCIO.TelefonoCelular=#{telefonoCelular}
 where SOCIO.IdSocio= #{codigo}
</update>

<update id="updatePersona" parameterType="IngSoft.venta.bean.PersonaMiniBeanData">
update PERSONA set PERSONA.ApeMaterno=#{apellidoMaterno}
,PERSONA.Nombres=#{nombres}
,PERSONA.ApePaterno=#{apellidoPaterno} 
,PERSONA.FechaNac=#{fechaNacimiento}
,PERSONA.NumeroDocumento=#{numeroDocumento}
 where PERSONA.IdPersona= #{codigo}
</update>

<!-- Fin modificar  

 -->


 
</mapper>
 